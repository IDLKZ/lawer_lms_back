# üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ NER + LLM Pipeline

## –®–∞–≥–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

```bash
pip install -r requirements.txt
```

–≠—Ç–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç:
- `spacy==3.7.2` - –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è NER
- –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞

### 2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Ä—É—Å—Å–∫—É—é –º–æ–¥–µ–ª—å SpaCy

```bash
python -m spacy download ru_core_news_sm
```

–ú–æ–¥–µ–ª—å –∑–∞–π–º–µ—Ç ~40MB –∏ –±—É–¥–µ—Ç —Å–∫–∞—á–∞–Ω–∞ –∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è SpaCy.

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —É—Å—Ç–∞–Ω–æ–≤–∫—É

```bash
python -c "import spacy; nlp = spacy.load('ru_core_news_sm'); print('‚úì SpaCy model loaded successfully')"
```

–î–æ–ª–∂–Ω–æ –≤—ã–≤–µ—Å—Ç–∏: `‚úì SpaCy model loaded successfully`

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

```bash
uvicorn app.main:app --reload
```

–í –ª–æ–≥–∞—Ö –≤—ã —É–≤–∏–¥–∏—Ç–µ:
```
INFO:app.services.llm_service:Testing connection to LLM (openrouter)...
INFO:     ‚úì Cloud LLM connection successful (openrouter)
```

### 5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ —á–µ—Ä–µ–∑ API

–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π PDF:

```bash
curl -X POST "http://localhost:8000/api/v1/cases/upload-pdf" \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@test_document.pdf"
```

–û—Ç–≤–µ—Ç –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å:
```json
{
  "ner_stats": {
    "total_replacements": 15,
    "persons": 3,
    "organizations": 2
  },
  "pipeline_used": "NER + LLM",
  "success": true
}
```

## üîß –í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### –ü—Ä–æ–±–ª–µ–º–∞: "ModuleNotFoundError: No module named 'spacy'"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
pip install spacy==3.7.2
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Can't find model 'ru_core_news_sm'"

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –º–æ–¥–µ–ª—å
python -m spacy download ru_core_news_sm

# –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –Ω–∞–ø—Ä—è–º—É—é
pip install https://github.com/explosion/spacy-models/releases/download/ru_core_news_sm-3.7.0/ru_core_news_sm-3.7.0-py3-none-any.whl
```

### –ü—Ä–æ–±–ª–µ–º–∞: NER —Å–ª–∏—à–∫–æ–º –º–µ–¥–ª–µ–Ω–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–†–µ—à–µ–Ω–∏–µ:**
NER –æ–±—ã—á–Ω–æ –∑–∞–Ω–∏–º–∞–µ—Ç 2-3 —Å–µ–∫—É–Ω–¥—ã –Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç. –ï—Å–ª–∏ –º–µ–¥–ª–µ–Ω–Ω–µ–µ:
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ SpaCy –∏—Å–ø–æ–ª—å–∑—É–µ—Ç CPU –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
2. –î–ª—è –±–æ–ª—å—à–∏—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (>20 —Å—Ç—Ä–∞–Ω–∏—Ü) –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –¥–æ 10 —Å–µ–∫—É–Ω–¥

### –ü—Ä–æ–±–ª–µ–º–∞: NER –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ

**–†–µ—à–µ–Ω–∏–µ:**
–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ! LLM –Ω–∞ –≤—Ç–æ—Ä–æ–º —ç—Ç–∞–ø–µ –ø–æ–¥—Ö–≤–∞—Ç–∏—Ç –ø—Ä–æ–ø—É—â–µ–Ω–Ω–æ–µ. –ù–æ –µ—Å–ª–∏ –≤–∏–¥–∏—Ç–µ —Å–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–ø—É—Å–∫–∏:
1. –î–æ–±–∞–≤—å—Ç–µ regex –ø–∞—Ç—Ç–µ—Ä–Ω –≤ `app/services/ner_service.py`
2. –ò–ª–∏ —É–ª—É—á—à–∏—Ç–µ SpaCy –º–æ–¥–µ–ª—å (—Å–º. –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é SpaCy)

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞

–ü–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–º –¥–æ–∫—É–º–µ–Ω—Ç–µ:

```python
from app.services.ner_service import preprocess_with_ner

text = """
–ü—Ä–æ–∫—É—Ä–æ—Ä –ò–≤–∞–Ω–æ–≤ –ò.–ò. (—Ç–µ–ª: +7-707-123-45-67) –æ–±—Ä–∞—Ç–∏–ª—Å—è –≤ —Å—É–¥
–ø–æ –∞–¥—Ä–µ—Å—É —É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 5. –ü—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç–µ–ª—å –¢–û–û ¬´–ö–æ–º–ø–∞–Ω–∏—è¬ª –Ω–µ —è–≤–∏–ª—Å—è.
"""

result = preprocess_with_ner(text)
print(f"Stats: {result['stats']}")
print(f"Preprocessed: {result['preprocessed_text']}")
```

–û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
```
Stats: {'total_replacements': 4, 'persons': 1, 'organizations': 1, ...}
Preprocessed: –ü—Ä–æ–∫—É—Ä–æ—Ä [–õ–ò–¶–û-1] (—Ç–µ–ª: [–¢–ï–õ–ï–§–û–ù]) –æ–±—Ä–∞—Ç–∏–ª—Å—è –≤ —Å—É–¥...
```

## ‚úÖ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –≤–∞—à–∞ —Å–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–≤—É—Ö—ç—Ç–∞–ø–Ω—ã–π NER + LLM pipeline –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤!

–ü–æ–¥—Ä–æ–±–Ω–µ–µ –æ —Ä–∞–±–æ—Ç–µ pipeline —Å–º. `NER_LLM_PIPELINE.md`
